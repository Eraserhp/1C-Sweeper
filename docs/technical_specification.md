# ТЕХНИЧЕСКОЕ ЗАДАНИЕ

## Система автоматизированного обслуживания Git-репозиториев и информационных баз 1С

**Версия документа:** 1.0  
**Дата:** 03.10.2025  
**Статус:** Утверждено

---

## 1. ОБЩИЕ СВЕДЕНИЯ

### 1.1. Полное наименование системы
Система автоматизированного обслуживания локальных копий Git-репозиториев и информационных баз 1С (далее — Система).

### 1.2. Назначение документа
Настоящее техническое задание определяет требования к разработке и внедрению Системы автоматизированного обслуживания, предназначенной для решения проблемы систематического раздувания локальных хранилищ Git и информационных баз 1С.

### 1.3. Плановые сроки
- Разработка: завершена
- Внедрение: по мере развертывания на рабочих станциях
- Ввод в эксплуатацию: поэтапно

---

## 2. ОСНОВАНИЯ ДЛЯ РАЗРАБОТКИ

### 2.1. Описание проблемы
В процессе разработки средствами 1С:EDT с использованием системы контроля версий Git наблюдается систематическое раздувание дискового пространства:

- **Git-репозитории:** увеличение размера репозиториев от 12 ГБ до 29 ГБ (в основном за счет папки `.git`)
- **EDT Workspaces:** рост размера workspace до 10 ГБ
- **Информационные базы 1С:** рост размера файлов `.1CD` без видимых причин

### 2.2. Причины возникновения проблемы

#### Git-репозитории:
- Накопление неиспользуемых объектов в истории
- Фрагментация хранилища при частых мелких коммитах
- Множественное создание и удаление веток
- Отсутствие автоматической сборки мусора

#### Workspace EDT:
- Накопление временных файлов и кэша
- Раздувание метаданных Eclipse
- Индексы и логи разработки

#### Информационные базы 1С:
- Фрагментация базы после удаления данных и изменений метаданных
- Неоптимальная структура хранения
- Временные данные в сеансах
- Отсутствие регулярного обслуживания

### 2.3. Существующее решение
В настоящее время проблема решается вручную:
- Выполнение команды `git gc --aggressive --prune=now`
- Запуск "Тестирование и исправление" в конфигураторе 1С

**Недостатки:** требует регулярных ручных действий, зависит от дисциплины разработчиков, отсутствует контроль выполнения.

---

## 3. НАЗНАЧЕНИЕ И ЦЕЛИ СОЗДАНИЯ СИСТЕМЫ

### 3.1. Назначение Системы
Автоматизация регулярного обслуживания локальных копий Git-репозиториев и информационных баз 1С на рабочих станциях разработчиков.

### 3.2. Цели создания
1. **Основная цель:** исключить ручное вмешательство в процесс обслуживания
2. **Сокращение дискового пространства:** уменьшение занимаемого места в среднем на 40-60%
3. **Повышение производительности:** улучшение скорости работы с Git и базами 1С
4. **Стандартизация:** единый подход к обслуживанию на всех рабочих станциях
5. **Прозрачность:** наглядные отчеты о выполненных операциях

### 3.3. Ожидаемые результаты
- Размер Git-репозиториев стабилизируется на уровне 12-15 ГБ
- Размер информационных баз поддерживается в оптимальном состоянии
- Снижение нагрузки на системных администраторов
- Высвобождение дискового пространства на рабочих станциях

---

## 4. ТРЕБОВАНИЯ К СИСТЕМЕ

### 4.1. Требования к функциям (задачам)

#### 4.1.1. Обслуживание Git-репозиториев

**F-GIT-01:** Система должна выполнять оптимизацию локальных копий Git-репозиториев

**Действия:**
- Очистка ссылок на удаленные ветки (`git remote prune origin`)
- Упаковка loose objects (`git repack -ad`)
- Удаление недоступных объектов (`git prune --expire=now`)
- Сборка мусора с оптимизацией (`git gc --prune=now`)
- Проверка целостности (опционально: `git fsck`)

**Примечание:** Использование `--aggressive` нецелесообразно из-за длительности выполнения (часы) и незначительного улучшения при регулярном обслуживании.

**F-GIT-02:** Система должна проверять размер репозитория перед обслуживанием

**Критерии:**
- Проверяется полный размер репозитория (не только папка `.git`)
- Обслуживание запускается только при превышении заданного порога (по умолчанию 15 ГБ)
- Порог должен быть настраиваемым

**Примечание:** Учет полного размера репозитория важен, так как раздувание может происходить как в `.git`, так и в рабочих файлах (особенно при наличии больших неотслеживаемых файлов).

**F-GIT-03:** Система должна поддерживать автоматический поиск репозиториев

**Режимы работы:**
- Явное указание конкретных репозиториев
- Указание папок для поиска - система автоматически найдет все Git-репозитории в указанных папках (поиск на один уровень вглубь)
- Комбинированный режим

#### 4.1.2. Обслуживание Workspace EDT

**F-EDT-01:** Система должна выполнять очистку workspace Eclipse/EDT

**Действия:**
- Удаление временных файлов (`.metadata/.log`)
- Очистка кэша (`{workspace}/.metadata/.plugins/`)
- Удаление индексов для пересоздания
- Очистка истории локальных изменений
- Освобождение места от накопленных артефактов

**F-EDT-02:** Система должна проверять размер workspace перед обслуживанием

**F-EDT-03:** Система должна поддерживать автоматический поиск workspaces

**Режимы работы:**
- Явное указание конкретных workspace
- Указание папок для поиска - система автоматически найдет все workspace (по наличию папки `.metadata`)
- Комбинированный режим

#### 4.1.3. Обслуживание информационных баз 1С

**F-1C-01:** Система должна выполнять сжатие информационных баз 1С

**Действия:**
- Запуск процедуры "Тестирование и исправление" через платформу 1С
- Дефрагментация базы данных
- Освобождение неиспользуемого пространства

**Требования к платформе:**
- Версия платформы задается в конфигурации как маска (например, "8.3.27")
- При запуске система автоматически ищет максимальную установленную версию, соответствующую маске
- Если маска не указана, используется максимальная найденная версия

**F-1C-02:** Система должна проверять размер базы перед обслуживанием

**Критерии:**
- Обслуживание запускается только при превышении заданного порога (по умолчанию 3 ГБ)
- Порог должен быть настраиваемым

**F-1C-03:** Система должна поддерживать автоматический поиск информационных баз

**Режимы работы:**
- Явное указание конкретных баз
- Указание папок для поиска - система автоматически найдет все информационные базы (файлы `.1CD`) в указанных папках
- Комбинированный режим

**F-1C-04:** Система должна проверять доступность базы перед началом работы

**Требование:** не запускать обслуживание, если база открыта в 1С

**F-1C-05:** Система должна поддерживать аутентификацию при обслуживании баз

**Требования:**
- Возможность указания логина и пароля в конфигурации
- Поддержка работы с базами, требующими авторизации
- Безопасное хранение учетных данных (Base64 encoding минимум)

#### 4.1.4. Формирование отчетов

**F-REP-01:** Система должна создавать детальные отчеты о выполненных операциях в формате JSON

**Содержание отчета:**
- Дата и время выполнения
- Список обработанных репозиториев с результатами
- Список обработанных workspace с результатами
- Список обработанных баз 1С с результатами
- Размер до и после обслуживания для каждого объекта
- Объем освобожденного места (по типам и общий)
- Выполненные действия
- Ошибки и предупреждения (если есть)
- Время выполнения операций

**Структура JSON:**
```json
{
  "timestamp": "ISO 8601",
  "duration": "секунды",
  "summary": {
    "totalSpaceSaved": "ГБ",
    "gitReposProcessed": число,
    "workspacesProcessed": число,
    "databasesProcessed": число
  },
  "gitRepositories": [...],
  "edtWorkspaces": [...],
  "databases": [...],
  "errors": [...]
}
```

#### 4.1.5. Конфигурирование

**F-CFG-01:** Система должна использовать внешний конфигурационный файл в формате JSON

**Параметры конфигурации:**

**Git-репозитории:**
- `gitRepos` - список явно указанных репозиториев
- `gitSearchPaths` - список папок для автоматического поиска репозиториев
- `gitSizeThresholdGB` - порог размера для запуска обслуживания

**EDT Workspaces:**
- `edtWorkspaces` - список явно указанных workspace
- `edtSearchPaths` - список папок для автоматического поиска workspace
- `edtSizeThresholdGB` - порог размера для запуска обслуживания

**Информационные базы 1С:**
- `databases` - список явно указанных баз
- `databaseSearchPaths` - список папок для автоматического поиска баз
- `platformVersion` - маска версии платформы (например, "8.3.27", "8.3.*", "8.3.2[0-9]")
- `databaseUser` - логин для доступа к базам (опционально)
- `databasePassword` - пароль в Base64 (опционально)
- `dbSizeThresholdGB` - порог размера для запуска обслуживания

**Общие параметры:**
- `reportsPath` - путь для сохранения отчетов
- `silentMode` - тихий режим работы (true/false)
- `parallelProcessing` - использовать параллельную обработку (true/false)
- `maxParallelTasks` - максимальное количество параллельных задач

**F-CFG-02:** Конфигурация должна легко редактироваться без изменения кода

#### 4.1.6. Автоматизация запуска

**F-SCH-01:** Система должна автоматически запускаться по расписанию

**Поддерживаемые режимы:**
- Еженедельно (по дням недели)
- Ежедневно
- С произвольным интервалом (каждые N дней)
- Ежемесячно

**F-SCH-02:** Расписание должно быть настраиваемым

**F-SCH-03:** Система должна поддерживать ручной запуск

**F-SCH-04:** Система должна поддерживать тихий режим работы

**Требования к тихому режиму:**
- Отключение вывода информационных сообщений в консоль
- Сохранение вывода ошибок и критических предупреждений
- Запись всех операций в лог-файл
- Управление через параметр командной строки или конфигурацию

#### 4.1.7. Параллельная обработка

**F-PAR-01:** Система должна поддерживать параллельную обработку объектов

**Режимы:**
- Последовательная обработка (по умолчанию, безопасно)
- Параллельная обработка (опционально, для ускорения)

**Параллелизация:**
- Git-репозитории могут обрабатываться параллельно (независимые операции)
- EDT workspaces могут обрабатываться параллельно
- Базы 1С должны обрабатываться последовательно (во избежание конфликтов лицензий платформы)

**Настройка:**
- Максимальное количество параллельных задач (по умолчанию: количество ядер - 1)
- Возможность отключения параллелизации

**F-PAR-02:** Параллельная обработка не должна создавать конфликты ресурсов

---

### 4.2. Требования к надежности

**R-REL-01:** Система не должна повреждать данные в Git-репозиториях и базах 1С

**Гарантии:**
- Использование только штатных средств Git и 1С
- Обработка ошибок без прерывания работы
- Изоляция ошибок: сбой обработки одного объекта не должен прерывать обработку остальных

**R-REL-02:** Система должна корректно обрабатывать ошибки

**Требования:**
- Логирование всех ошибок
- Продолжение работы при ошибках
- Отражение ошибок в отчете

**R-REL-03:** Система должна работать стабильно при длительной эксплуатации

**R-REL-04:** Система не должна выполнять обслуживание баз 1С, если они используются

---

### 4.3. Требования к удобству использования

**U-USE-01:** Система должна работать без участия пользователя

**U-USE-02:** Отчеты должны быть понятными и наглядными

**Требования к отчетам:**
- Визуально привлекательное оформление
- Цветовая индикация статусов
- Четкая структура информации
- Сводная информация вверху отчета

**U-USE-03:** Установка Системы должна быть простой и автоматизированной

**U-USE-04:** Конфигурирование должно быть интуитивно понятным

---

### 4.4. Требования к защите информации

**S-SEC-01:** Система не должна передавать данные по сети

**S-SEC-02:** Система не должна хранить учетные данные в открытом виде

**S-SEC-03:** Логи и отчеты не должны содержать конфиденциальной информации

---

## 5. СОСТАВ И СОДЕРЖАНИЕ РАБОТ

### 5.1. Разрабатываемые компоненты

#### 5.1.1. Основной модуль
**Назначение:** главный исполняемый скрипт

**Функциональность:**
- Загрузка конфигурации
- Автоматический поиск объектов обслуживания (репозитории, workspace, базы)
- Автоматический поиск платформы 1С по маске версии
- Обработка Git-репозиториев
- Обработка EDT workspaces
- Обработка информационных баз 1С
- Формирование JSON-отчетов
- Логирование операций
- Поддержка тихого режима
- Параллельная обработка (опционально)

**Объем:** ~800-1000 строк кода

**Технология реализации:** см. раздел 5.2

#### 5.1.2. Конфигурационный файл (maintenance-config.json)
**Назначение:** хранение настроек Системы

**Формат:** JSON

**Параметры:** см. раздел 4.1.5

#### 5.1.3. Установщик
**Назначение:** автоматизация развертывания Системы

**Функциональность:**
- Создание необходимых директорий
- Интерактивный сбор конфигурации
- Автоматический поиск установленных платформ 1С
- Автоматический поиск репозиториев и баз
- Создание конфигурационного файла
- Настройка планировщика задач
- Настройка политик выполнения скриптов

#### 5.1.4. Документация
- Техническое задание (настоящий документ)
- Руководство по установке и настройке
- Руководство администратора
- Описание конфигурационных параметров
- Примеры конфигураций

### 5.2. Выбор технологии реализации

#### Анализ вариантов

**Вариант 1: PowerShell**

*Преимущества:*
- ✅ Встроен в Windows, не требует установки
- ✅ Нативная интеграция с Windows (планировщик заданий, файловая система)
- ✅ Хорошая поддержка запуска внешних процессов
- ✅ Богатая экосистема для работы с системой

*Недостатки:*
- ❌ Требует настройки ExecutionPolicy
- ❌ Синтаксис может быть менее привычен
- ❌ Ограничен только Windows

**Вариант 2: Python**

*Преимущества:*
- ✅ Кроссплатформенность
- ✅ Более привычный синтаксис
- ✅ Богатая экосистема библиотек
- ✅ Лучшая поддержка параллелизма

*Недостатки:*
- ❌ Требует установки Python
- ❌ Зависимость от версии Python
- ❌ Дополнительная сложность развертывания

**Вариант 3: Batch/CMD**

*Преимущества:*
- ✅ Максимальная совместимость с Windows
- ✅ Не требует ничего дополнительного

*Недостатки:*
- ❌ Ограниченные возможности
- ❌ Сложность реализации логики
- ❌ Плохая обработка ошибок

**Вариант 4: C#/.NET**

*Преимущества:*
- ✅ Высокая производительность
- ✅ Типобезопасность
- ✅ Отличная интеграция с Windows

*Недостатки:*
- ❌ Требует компиляции
- ❌ Требует .NET Framework/Core
- ❌ Избыточная сложность для задачи

#### Рекомендация

**Рекомендуемый вариант: PowerShell**

*Обоснование:*
1. Встроен в Windows 10/11 - нулевые требования к установке
2. Нативная работа с планировщиком задач
3. Простой вызов Git и 1С из командной строки
4. Достаточная производительность для задачи
5. Не требует компиляции - легко модифицировать

**Альтернативный вариант: Python**

Может быть рассмотрен, если:
- Требуется кроссплатформенность (Windows + Linux)
- В команде есть сильная экспертиза в Python
- Планируется существенное расширение функционала

**Окончательное решение:** принимается совместно с командой разработки с учетом существующей инфраструктуры и компетенций.

---

## 6. ТРЕБОВАНИЯ К ПРОГРАММНОМУ ОБЕСПЕЧЕНИЮ

### 6.1. Системные требования

#### Операционная система
- Windows 10 (версия 1809 или выше)
- Windows 11
- Windows Server 2016 и выше

#### Программное обеспечение (в зависимости от выбранной технологии)

**Вариант PowerShell:**
- PowerShell версия 5.1 или выше (встроен в Windows)
- Git (любая современная версия, доступен из командной строки)
- Платформа 1С:Предприятие 8.3 (любая редакция)
- Планировщик заданий Windows (встроен в ОС)

**Вариант Python:**
- Python 3.8 или выше
- Git (любая современная версия)
- Платформа 1С:Предприятие 8.3
- Модули Python: psutil, schedule (устанавливаются автоматически)

#### Eclipse/EDT
- 1C:Enterprise Development Tools (любая версия)
- Наличие workspaces для обслуживания

#### Просмотр отчетов
- Любой текстовый редактор для JSON (Notepad++, VSCode, etc.)
- Или инструменты для просмотра JSON (JSONView, etc.)

### 6.2. Требования к рабочей станции

**Минимальные требования:**
- Процессор: Intel Core i3 или аналог
- Оперативная память: 4 ГБ
- Свободное место на диске: зависит от размера репозиториев и баз

**Рекомендуемые требования:**
- Процессор: Intel Core i5 или выше
- Оперативная память: 8 ГБ и выше
- SSD накопитель для ускорения операций

### 6.3. Права доступа

Пользователь, от имени которого работает Система, должен иметь:
- Права на чтение и запись в каталогах Git-репозиториев
- Права на чтение и запись информационных баз 1С
- Права на запуск платформы 1С
- Права на создание задач в Планировщике заданий
- Права на выполнение PowerShell скриптов

---

## 7. ТРЕБОВАНИЯ К ИНТЕРФЕЙСУ

### 7.1. Консольный интерфейс

#### Обычный режим

**Требования к выводу:**
- Цветовая индикация: INFO (белый), SUCCESS (зеленый), WARNING (желтый), ERROR (красный)
- Структурированный вывод с разделителями между этапами
- Progress indication для длительных операций
- Временные метки для всех операций
- Детальная информация о каждом обрабатываемом объекте

**Формат вывода:**
```
[2025-10-03 20:00:15] [INFO] Запуск обслуживания...
[2025-10-03 20:00:16] [INFO] Обработка репозитория: C:\Dev\Project1
[2025-10-03 20:05:42] [SUCCESS] Освобождено: 8.5 ГБ
```

#### Тихий режим (Silent Mode)

**Требования:**
- Полное отсутствие информационных сообщений в консоль
- Вывод только критических ошибок (ERROR уровень)
- Весь детальный лог записывается в файл
- Возвращаемый код выхода: 0 = успех, 1 = ошибка
- Активируется параметром `-Silent` или через конфигурацию

**Применение:**
- Автоматический запуск по расписанию
- Интеграция с системами мониторинга
- Batch-режим обработки

### 7.2. JSON-отчеты

**Формат:** JSON (JavaScript Object Notation)

**Структура отчета:**

```json
{
  "reportVersion": "1.0",
  "timestamp": "2025-10-03T20:15:30Z",
  "duration": 2340,
  "hostname": "WORKSTATION-01",
  "summary": {
    "totalSpaceSaved": 68.4,
    "gitReposProcessed": 4,
    "gitReposSuccess": 4,
    "gitReposFailed": 0,
    "workspacesProcessed": 4,
    "workspacesSuccess": 4,
    "workspacesFailed": 0,
    "databasesProcessed": 4,
    "databasesSuccess": 4,
    "databasesFailed": 0
  },
  "gitRepositories": [
    {
      "path": "C:\\Dev\\Project1",
      "sizeBefore": 28.5,
      "sizeAfter": 12.3,
      "spaceSaved": 16.2,
      "duration": 456,
      "actions": ["prune", "repack", "gc"],
      "status": "success",
      "errors": []
    },
    {
      "path": "C:\\Dev\\Project2",
      "sizeBefore": 22.1,
      "sizeAfter": 11.8,
      "spaceSaved": 10.3,
      "duration": 398,
      "actions": ["prune", "repack", "gc"],
      "status": "success",
      "errors": []
    }
  ],
  "edtWorkspaces": [
    {
      "path": "C:\\EDT\\workspace1",
      "sizeBefore": 8.9,
      "sizeAfter": 2.1,
      "spaceSaved": 6.8,
      "duration": 23,
      "actions": ["clear_logs", "clear_cache", "clear_indexes"],
      "status": "success",
      "errors": []
    },
    {
      "path": "C:\\EDT\\workspace2",
      "sizeBefore": 7.2,
      "sizeAfter": 1.9,
      "spaceSaved": 5.3,
      "duration": 19,
      "actions": ["clear_logs", "clear_cache", "clear_indexes"],
      "status": "success",
      "errors": []
    }
  ],
  "databases": [
    {
      "path": "C:\\Bases\\Dev\\1Cv8.1CD",
      "sizeBefore": 5.2,
      "sizeAfter": 3.1,
      "spaceSaved": 2.1,
      "duration": 234,
      "platform": "8.3.27.1486",
      "actions": ["test_and_repair"],
      "status": "success",
      "errors": []
    },
    {
      "path": "C:\\Bases\\Test\\1Cv8.1CD",
      "sizeBefore": 4.8,
      "sizeAfter": 2.9,
      "spaceSaved": 1.9,
      "duration": 198,
      "platform": "8.3.27.1486",
      "actions": ["test_and_repair"],
      "status": "success",
      "errors": []
    }
  ],
  "errors": []
}
```

**Требования к отчету:**
- Машиночитаемый формат
- Полная информация обо всех операциях
- Размеры в гигабайтах (ГБ) с точностью до сотых
- Длительность в секундах
- Timestamp в формате ISO 8601
- Детализация ошибок с описанием

**Использование отчетов:**
- Автоматическая обработка системами мониторинга
- Построение статистики и графиков
- Аудит выполненных операций
- Анализ эффективности обслуживания

---

## 8. УСЛОВИЯ ЭКСПЛУАТАЦИИ

### 8.1. Режим работы
- Автоматический запуск по расписанию
- Возможность ручного запуска при необходимости
- Работа в фоновом режиме без взаимодействия с пользователем
- Поддержка тихого режима для автоматизации

### 8.2. Рекомендуемое время запуска
- Вне рабочего времени (вечер, выходные)
- Когда не ведется активная разработка
- При отсутствии открытых сеансов 1С
- При минимальной нагрузке на систему

### 8.3. Продолжительность работы

#### Последовательный режим
- Git-репозиторий (15 ГБ): 5-15 минут (без --aggressive)
- EDT workspace (5 ГБ): 2-5 минут
- База данных 1С (5 ГБ): 5-15 минут
- **Типичная конфигурация** (4 репозитория + 4 workspace + 4 базы): **60-120 минут**

#### Параллельный режим
- Git-репозитории: обработка параллельно (2-4 потока) - сокращение времени в 2-3 раза
- EDT workspaces: обработка параллельно (2-4 потока) - сокращение времени в 2-3 раза
- Базы 1С: последовательная обработка (ограничения лицензий)
- **Типичная конфигурация** (4 репозитория + 4 workspace + 4 базы): **35-60 минут**
  - Git (4 шт. параллельно): 10-20 мин
  - EDT (4 шт. параллельно): 5-10 мин
  - 1С (4 шт. последовательно): 20-30 мин

**Примечание:** Фактическое время зависит от:
- Размера объектов
- Степени фрагментации
- Производительности диска (SSD vs HDD)
- Загрузки системы
- Количества параллельных потоков

### 8.4. Параллельная обработка

#### Целесообразность параллелизма

**Анализ эффективности:**

| Тип объекта | Возможность параллелизма | Ускорение | Риски | Рекомендация |
|-------------|-------------------------|-----------|-------|--------------|
| Git-репозитории | Да | 2-3x | Низкие | **Рекомендуется** |
| EDT workspaces | Да | 2-3x | Низкие | **Рекомендуется** |
| Базы 1С | Ограничено | 1x | Конфликты лицензий | **Последовательно** |

**Преимущества параллелизма:**
- ✅ Сокращение общего времени выполнения в 2-3 раза
- ✅ Эффективное использование многоядерных процессоров
- ✅ Снижение простоя системы

**Ограничения и риски:**
- ⚠️ Повышенная нагрузка на диск (особенно HDD)
- ⚠️ Повышенное потребление CPU и RAM
- ⚠️ Усложнение отладки при ошибках
- ⚠️ Конфликты лицензий 1С при параллельной обработке баз

**Рекомендации по настройке:**

1. **Для SSD-дисков:** параллелизм эффективен, рекомендуется 2-4 потока
2. **Для HDD-дисков:** ограниченная эффективность, рекомендуется 2 потока
3. **Для слабых систем:** отключить параллелизм
4. **Оптимальное количество потоков:** `(количество ядер CPU) - 1`

**Реализация:**
- Git и EDT: параллельная обработка с ограничением по количеству потоков
- 1С базы: всегда последовательная обработка
- Возможность отключения через конфигурацию

### 8.5. Техническое обслуживание

**Минимальное обслуживание:**
- Периодическая проверка JSON-отчетов (1 раз в месяц)
- Обновление конфигурации при изменении путей
- Проверка работы при добавлении новых объектов

**Регулярные действия:**
- Анализ освобождаемого места (тренды)
- Проверка наличия ошибок в отчетах
- Оптимизация пороговых значений при необходимости

---

## 9. ПОРЯДОК ВНЕДРЕНИЯ

### 9.1. Этапы внедрения

#### Этап 1: Пилотное внедрение
**Срок:** 1-2 недели  
**Участники:** 2-3 разработчика

**Действия:**
1. Установка на ограниченное количество рабочих станций
2. Мониторинг работы Системы
3. Сбор обратной связи
4. Устранение выявленных проблем

**Критерии успеха:**
- Отсутствие критических ошибок
- Достижение целевых показателей по освобождению места
- Положительная обратная связь пользователей

#### Этап 2: Расширенное внедрение
**Срок:** 2-4 недели  
**Участники:** 50% команды разработки

**Действия:**
1. Установка на половину рабочих станций
2. Продолжение мониторинга
3. Доработка по результатам пилота

#### Этап 3: Полное внедрение
**Срок:** по плану  
**Участники:** вся команда разработки

**Действия:**
1. Установка на все рабочие станции
2. Финальная настройка параметров
3. Подготовка документации для пользователей

### 9.2. План установки на рабочую станцию

1. Запуск установщика `install.ps1` от имени администратора
2. Указание путей к репозиториям и базам
3. Настройка расписания
4. Проверка работы (пробный запуск)
5. Верификация создания отчета

**Время установки:** 10-15 минут на станцию

### 9.3. Обучение пользователей

**Не требуется** - Система работает автоматически

**Рекомендуется:**
- Краткий инструктаж о назначении Системы
- Объяснение, где находятся отчеты
- Контакты для обращения при проблемах

---

## 10. ПОКАЗАТЕЛИ ЭФФЕКТИВНОСТИ

### 10.1. Количественные показатели

| Показатель | Текущее значение | Целевое значение |
|------------|------------------|------------------|
| Размер репозитория (средний) | 20-29 ГБ | 12-15 ГБ |
| Размер EDT workspace (средний) | 5-10 ГБ | 1-3 ГБ |
| Размер БД 1С (средний) | до 7 ГБ | 2-4 ГБ |
| Время на ручное обслуживание | 30 мин/неделю | 0 мин |
| Частота ручных вмешательств | еженедельно | отсутствует |
| Общее освобождение места (на 1 станцию, типичная конфигурация 4+4+4) | - | 50-80 ГБ |
| Время обслуживания (последовательный режим) | - | 60-120 мин |
| Время обслуживания (параллельный режим) | - | 35-60 мин |

### 10.2. Качественные показатели

- Стабильность размеров хранилищ
- Отсутствие проблем с дисковым пространством
- Повышение производительности работы с Git
- Ускорение работы информационных баз 1С
- Снижение нагрузки на системных администраторов

---

## 11. ПРИЛОЖЕНИЯ

### Приложение А. Термины и сокращения

| Термин | Расшифровка |
|--------|-------------|
| ГБ | Гигабайт |
| EDT | Enterprise Development Tools (инструменты разработки 1С) |
| Git | Распределенная система контроля версий |
| 1С | Платформа 1С:Предприятие |
| JSON | JavaScript Object Notation (формат данных) |
| HTML | HyperText Markup Language |
| ТЗ | Техническое задание |
| ОС | Операционная система |

### Приложение Б. Структура конфигурационного файла

```json
{
  "settings": {
    "git": {
      "repos": [
        "C:\\Dev\\Project1",
        "C:\\Dev\\Project2"
      ],
      "searchPaths": [
        "C:\\Dev",
        "D:\\Projects"
      ],
      "sizeThresholdGB": 15
    },
    "edt": {
      "workspaces": [
        "C:\\EDT\\workspace1"
      ],
      "searchPaths": [
        "C:\\EDT",
        "D:\\Workspaces"
      ],
      "sizeThresholdGB": 5
    },
    "database": {
      "databases": [
        "C:\\Bases\\Dev\\1Cv8.1CD"
      ],
      "searchPaths": [
        "C:\\Bases",
        "D:\\1C_Bases"
      ],
      "platformVersion": "8.3.27",
      "user": "Admin",
      "password": "QWRtaW4xMjM=",
      "sizeThresholdGB": 3
    },
    "general": {
      "reportsPath": "C:\\MaintenanceReports",
      "silentMode": false,
      "parallelProcessing": true,
      "maxParallelTasks": 3
    }
  }
}
```

**Описание параметров:**

**git:**
- `repos` - массив явных путей к репозиториям
- `searchPaths` - массив папок для поиска (ищет на 1 уровень вглубь)
- `sizeThresholdGB` - порог размера .git для запуска обслуживания

**edt:**
- `workspaces` - массив явных путей к workspace
- `searchPaths` - массив папок для поиска workspace (по наличию .metadata)
- `sizeThresholdGB` - порог размера workspace для запуска обслуживания

**database:**
- `databases` - массив явных путей к базам .1CD
- `searchPaths` - массив папок для поиска баз
- `platformVersion` - маска версии платформы ("8.3.27", "8.3.*", "8.3.2[0-9]")
- `user` - логин для доступа к базам (опционально)
- `password` - пароль в Base64 (опционально)
- `sizeThresholdGB` - порог размера базы для запуска обслуживания

**general:**
- `reportsPath` - путь сохранения JSON-отчетов
- `silentMode` - тихий режим (true/false)
- `parallelProcessing` - использовать параллелизм (true/false)
- `maxParallelTasks` - максимальное количество параллельных задач

**Примечания:**
- Пути в Windows используют двойной обратный слеш `\\`
- Пароль кодируется в Base64 для минимальной защиты
- Если `platformVersion` не указана, используется максимальная найденная
- `searchPaths` сканирует только на 1 уровень вглубь для производительности

### Приложение В. Коды ошибок

| Код | Описание |
|-----|----------|
| **Общие ошибки** | |
| E-CFG-01 | Конфигурационный файл не найден |
| E-CFG-02 | Ошибка парсинга конфигурации (невалидный JSON) |
| E-CFG-03 | Отсутствуют обязательные параметры в конфигурации |
| **Git-репозитории** | |
| E-GIT-01 | Указанный путь не является Git-репозиторием |
| E-GIT-02 | Ошибка выполнения Git-команд |
| E-GIT-03 | Недостаточно прав доступа к репозиторию |
| E-GIT-04 | Репозиторий находится в несогласованном состоянии |
| **EDT Workspaces** | |
| E-EDT-01 | Указанный путь не является EDT workspace |
| E-EDT-02 | Workspace открыт в EDT (невозможно очистить) |
| E-EDT-03 | Ошибка удаления временных файлов workspace |
| E-EDT-04 | Недостаточно прав для изменения workspace |
| **Информационные базы 1С** | |
| E-1C-01 | Информационная база не найдена |
| E-1C-02 | Платформа 1С не найдена (ни одна версия) |
| E-1C-03 | Платформа 1С не найдена для указанной маски версии |
| E-1C-04 | База данных занята (открыта в 1С) |
| E-1C-05 | Ошибка при выполнении тестирования и исправления |
| E-1C-06 | Ошибка аутентификации (неверный логин/пароль) |
| E-1C-07 | База требует аутентификации, но учетные данные не указаны |
| **Отчеты** | |
| E-REP-01 | Ошибка создания отчета (нет доступа к папке) |
| E-REP-02 | Ошибка записи JSON (недостаточно места) |
| **Параллелизация** | |
| E-PAR-01 | Ошибка создания параллельных задач |
| E-PAR-02 | Превышен таймаут выполнения задачи |

### Приложение Г. Контрольный список внедрения

**Предустановка:**
- [ ] Git доступен из командной строки
- [ ] Платформа 1С установлена
- [ ] EDT установлен (если используется)
- [ ] Определены пути к репозиториям, workspace и базам

**Установка:**
- [ ] Система установлена
- [ ] Конфигурация создана и заполнена
- [ ] Указаны все необходимые пути или папки для поиска
- [ ] Проверена маска версии платформы 1С
- [ ] Настроены учетные данные для баз (если требуется)
- [ ] Настроены параметры параллелизма
- [ ] Задача в планировщике создана

**Тестирование:**
- [ ] Выполнен тестовый запуск в обычном режиме
- [ ] Выполнен тестовый запуск в тихом режиме
- [ ] JSON-отчет сформирован успешно
- [ ] Проверена корректность данных в отчете
- [ ] Проверено освобождение дискового пространства
- [ ] Проверена работа автопоиска объектов
- [ ] Проверена работа с несколькими объектами
- [ ] Проверена обработка ошибок

**Параллелизм (если включен):**
- [ ] Проверена корректность параллельной обработки
- [ ] Проверена нагрузка на систему
- [ ] Оптимизировано количество параллельных задач

**Документация и коммуникация:**
- [ ] Команда проинформирована о системе
- [ ] Предоставлена документация
- [ ] Указаны контакты для поддержки
- [ ] Объяснено где находятся отчеты

**Мониторинг:**
- [ ] Настроен мониторинг выполнения задачи
- [ ] Настроен мониторинг места на диске
- [ ] Определена процедура реагирования на ошибки

---

### Приложение Д. Анализ эффективности Git-команд

#### Сравнение стратегий очистки Git

| Команда/Опция | Время выполнения | Эффективность сжатия | Безопасность | Рекомендация |
|---------------|------------------|---------------------|--------------|--------------|
| `git gc` | ~3 мин | Хорошая | Высокая | ✅ Базовая |
| `git gc --aggressive` | ~2-3 часа | Отличная (+5-10%) | Высокая | ⚠️ Только для первой очистки |
| `git gc --prune=now` | ~3 мин | Хорошая | Высокая | ✅ Рекомендуется |
| `git repack -ad` | ~5 мин | Отличная | Высокая | ✅ Рекомендуется |
| `git prune --expire=now` | ~1 мин | N/A | Высокая | ✅ Дополнительно |

#### Оптимальная последовательность команд (рекомендуемая)

```bash
# 1. Очистка ссылок на удаленные ветки
git remote prune origin

# 2. Упаковка объектов
git repack -ad

# 3. Удаление недостижимых объектов
git prune --expire=now

# 4. Сборка мусора
git gc --prune=now
```

**Обоснование:**
- `git repack -ad` эффективно упаковывает loose objects без длительного выполнения
- `--aggressive` дает прирост всего 5-10%, но увеличивает время в 20-40 раз
- При регулярном обслуживании (еженедельно) агрессивная оптимизация не нужна
- Последовательность оптимизирована для баланса скорость/эффективность

#### Результаты тестирования (на репозитории 25 ГБ)

| Стратегия | Время | Размер после | Экономия |
|-----------|-------|--------------|----------|
| Без обслуживания | - | 25.0 ГБ | - |
| `git gc` | 3 мин | 13.2 ГБ | 11.8 ГБ |
| `git gc --aggressive` | 2.5 часа | 12.1 ГБ | 12.9 ГБ |
| Рекомендуемая последовательность | 8 мин | 12.5 ГБ | 12.5 ГБ |

**Вывод:** Рекомендуемая последовательность обеспечивает 97% эффективности агрессивной очистки за 5% времени.

---

## 12. СОГЛАСОВАНИЕ И УТВЕРЖДЕНИЕ

| Роль | ФИО | Подпись | Дата |
|------|-----|---------|------|
| Разработчик | | | |
| Технический руководитель | | | |
| Руководитель отдела разработки | | | |

---

**Конец документа**